-- LocalScript (StarterPlayerScripts)
-- Universal Teleport System [FIXED - ACTUALLY WORKS]

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local character, humanoid, hrp

local savedLocations = {}
local MAX_LOCATIONS = 20
local antiTPBack = true
local tpMethod = "cframe"
local toolEquipped = false

local function setupCharacter(char)
	character = char
	humanoid = char:WaitForChild("Humanoid")
	hrp = char:FindFirstChild("HumanoidRootPart") or char:WaitForChild("HumanoidRootPart")
end

if player.Character then setupCharacter(player.Character) end
player.CharacterAdded:Connect(setupCharacter)

-- GUI
local gui = Instance.new("ScreenGui")
gui.Name = "UniversalTeleportUI"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

-- Draggable button
local openBtn = Instance.new("TextButton")
openBtn.Size = UDim2.new(0, 60, 0, 60)
openBtn.Position = UDim2.new(1, -75, 1, -75)
openBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
openBtn.Text = "üìç"
openBtn.TextSize = 28
openBtn.Font = Enum.Font.GothamBold
openBtn.TextColor3 = Color3.fromRGB(100, 200, 255)
openBtn.BorderSizePixel = 0
openBtn.Active = true
openBtn.Draggable = true
openBtn.ZIndex = 10
openBtn.Parent = gui

local btnCorner = Instance.new("UICorner")
btnCorner.CornerRadius = UDim.new(0.3, 0)
btnCorner.Parent = openBtn

local btnStroke = Instance.new("UIStroke")
btnStroke.Color = Color3.fromRGB(100, 200, 255)
btnStroke.Thickness = 2
btnStroke.Parent = openBtn

-- Badge
local badge = Instance.new("Frame")
badge.Size = UDim2.new(0, 20, 0, 20)
badge.Position = UDim2.new(1, -8, 0, -8)
badge.BackgroundColor3 = Color3.fromRGB(255, 70, 70)
badge.BorderSizePixel = 0
badge.ZIndex = 11
badge.Parent = openBtn

local badgeCorner = Instance.new("UICorner")
badgeCorner.CornerRadius = UDim.new(1, 0)
badgeCorner.Parent = badge

local badgeText = Instance.new("TextLabel")
badgeText.Size = UDim2.new(1, 0, 1, 0)
badgeText.BackgroundTransparency = 1
badgeText.Text = "0"
badgeText.TextSize = 10
badgeText.Font = Enum.Font.GothamBold
badgeText.TextColor3 = Color3.new(1, 1, 1)
badgeText.ZIndex = 12
badgeText.Parent = badge

-- Main Frame (DRAGGABLE + PROPER POSITION!)
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 340, 0, 480)
mainFrame.Position = UDim2.new(0.5, -170, 0.5, -240)
mainFrame.BackgroundColor3 = Color3.fromRGB(18, 18, 25)
mainFrame.BorderSizePixel = 0
mainFrame.Visible = false
mainFrame.Active = true
mainFrame.Draggable = true -- MAKE IT DRAGGABLE!
mainFrame.ZIndex = 5
mainFrame.Parent = gui

local frameCorner = Instance.new("UICorner")
frameCorner.CornerRadius = UDim.new(0, 14)
frameCorner.Parent = mainFrame

local frameStroke = Instance.new("UIStroke")
frameStroke.Color = Color3.fromRGB(100, 150, 255)
frameStroke.Thickness = 2.5
frameStroke.Transparency = 0.3
frameStroke.Parent = mainFrame

-- Gradient overlay for depth
local frameGradient = Instance.new("UIGradient")
frameGradient.Color = ColorSequence.new({
	ColorSequenceKeypoint.new(0, Color3.fromRGB(25, 25, 35)),
	ColorSequenceKeypoint.new(1, Color3.fromRGB(15, 15, 22))
})
frameGradient.Rotation = 90
frameGradient.Parent = mainFrame

-- Background blur
local blur = Instance.new("Frame")
blur.Size = UDim2.new(1, 0, 1, 0)
blur.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
blur.BackgroundTransparency = 0.5
blur.BorderSizePixel = 0
blur.Visible = false
blur.ZIndex = 4
blur.Parent = gui

-- Top bar (IMPROVED)
local topBar = Instance.new("Frame")
topBar.Size = UDim2.new(1, 0, 0, 55)
topBar.BackgroundColor3 = Color3.fromRGB(30, 30, 42)
topBar.BorderSizePixel = 0
topBar.ZIndex = 6
topBar.Parent = mainFrame

local topCorner = Instance.new("UICorner")
topCorner.CornerRadius = UDim.new(0, 14)
topCorner.Parent = topBar

local topGradient = Instance.new("UIGradient")
topGradient.Color = ColorSequence.new({
	ColorSequenceKeypoint.new(0, Color3.fromRGB(60, 100, 200)),
	ColorSequenceKeypoint.new(1, Color3.fromRGB(100, 60, 200))
})
topGradient.Rotation = 45
topGradient.Parent = topBar

-- Icon next to title
local titleIcon = Instance.new("TextLabel")
titleIcon.Size = UDim2.new(0, 30, 0, 30)
titleIcon.Position = UDim2.new(0, 12, 0, 12)
titleIcon.BackgroundTransparency = 1
titleIcon.Text = "üåê"
titleIcon.TextSize = 22
titleIcon.ZIndex = 7
titleIcon.Parent = topBar

-- Title
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -100, 1, 0)
title.Position = UDim2.new(0, 45, 0, 0)
title.BackgroundTransparency = 1
title.Text = "TELEPORT"
title.TextSize = 19
title.Font = Enum.Font.GothamBold
title.TextColor3 = Color3.new(1, 1, 1)
title.TextXAlignment = Enum.TextXAlignment.Left
title.ZIndex = 7
title.Parent = topBar

-- Subtitle
local subtitle = Instance.new("TextLabel")
subtitle.Size = UDim2.new(1, -100, 0, 15)
subtitle.Position = UDim2.new(0, 45, 0, 30)
subtitle.BackgroundTransparency = 1
subtitle.Text = "Universal System"
subtitle.TextSize = 10
subtitle.Font = Enum.Font.Gotham
subtitle.TextColor3 = Color3.fromRGB(200, 200, 200)
subtitle.TextXAlignment = Enum.TextXAlignment.Left
subtitle.ZIndex = 7
subtitle.Parent = topBar

-- Close button (BETTER DESIGN)
local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0, 42, 0, 42)
closeBtn.Position = UDim2.new(1, -48, 0, 6)
closeBtn.BackgroundColor3 = Color3.fromRGB(255, 70, 70)
closeBtn.Text = "‚úï"
closeBtn.TextSize = 20
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextColor3 = Color3.new(1, 1, 1)
closeBtn.BorderSizePixel = 0
closeBtn.ZIndex = 7
closeBtn.Parent = topBar

local closeCorner = Instance.new("UICorner")
closeCorner.CornerRadius = UDim.new(0.25, 0)
closeCorner.Parent = closeBtn

local closeStroke = Instance.new("UIStroke")
closeStroke.Color = Color3.fromRGB(255, 100, 100)
closeStroke.Thickness = 1.5
closeStroke.Transparency = 0.5
closeStroke.Parent = closeBtn

-- TP Tool Section (IMPROVED)
local toolFrame = Instance.new("Frame")
toolFrame.Size = UDim2.new(1, -20, 0, 75)
toolFrame.Position = UDim2.new(0, 10, 0, 65)
toolFrame.BackgroundColor3 = Color3.fromRGB(28, 28, 38)
toolFrame.BorderSizePixel = 0
toolFrame.ZIndex = 6
toolFrame.Parent = mainFrame

local toolFrameCorner = Instance.new("UICorner")
toolFrameCorner.CornerRadius = UDim.new(0, 10)
toolFrameCorner.Parent = toolFrame

local toolStroke = Instance.new("UIStroke")
toolStroke.Color = Color3.fromRGB(80, 120, 200)
toolStroke.Thickness = 1.5
toolStroke.Transparency = 0.6
toolStroke.Parent = toolFrame

local toolIcon = Instance.new("TextLabel")
toolIcon.Size = UDim2.new(0, 45, 0, 45)
toolIcon.Position = UDim2.new(0, 12, 0, 15)
toolIcon.BackgroundTransparency = 1
toolIcon.Text = "üéØ"
toolIcon.TextSize = 32
toolIcon.ZIndex = 7
toolIcon.Parent = toolFrame

local toolTitle = Instance.new("TextLabel")
toolTitle.Size = UDim2.new(1, -160, 0, 22)
toolTitle.Position = UDim2.new(0, 62, 0, 10)
toolTitle.BackgroundTransparency = 1
toolTitle.Text = "TP TOOL"
toolTitle.TextSize = 14
toolTitle.Font = Enum.Font.GothamBold
toolTitle.TextColor3 = Color3.fromRGB(100, 200, 255)
toolTitle.TextXAlignment = Enum.TextXAlignment.Left
toolTitle.ZIndex = 7
toolTitle.Parent = toolFrame

local toolDesc = Instance.new("TextLabel")
toolDesc.Size = UDim2.new(1, -160, 0, 28)
toolDesc.Position = UDim2.new(0, 62, 0, 32)
toolDesc.BackgroundTransparency = 1
toolDesc.Text = "Tap anywhere on screen"
toolDesc.TextSize = 11
toolDesc.Font = Enum.Font.Gotham
toolDesc.TextColor3 = Color3.fromRGB(160, 160, 160)
toolDesc.TextXAlignment = Enum.TextXAlignment.Left
toolDesc.TextWrapped = true
toolDesc.ZIndex = 7
toolDesc.Parent = toolFrame

local equipBtn = Instance.new("TextButton")
equipBtn.Size = UDim2.new(0, 78, 0, 32)
equipBtn.Position = UDim2.new(1, -88, 0, 22)
equipBtn.BackgroundColor3 = Color3.fromRGB(70, 160, 255)
equipBtn.Text = "EQUIP"
equipBtn.TextSize = 12
equipBtn.Font = Enum.Font.GothamBold
equipBtn.TextColor3 = Color3.new(1, 1, 1)
equipBtn.BorderSizePixel = 0
equipBtn.ZIndex = 7
equipBtn.Parent = toolFrame

local equipCorner = Instance.new("UICorner")
equipCorner.CornerRadius = UDim.new(0, 8)
equipCorner.Parent = equipBtn

local equipStroke = Instance.new("UIStroke")
equipStroke.Color = Color3.fromRGB(100, 180, 255)
equipStroke.Thickness = 1.5
equipStroke.Transparency = 0.5
equipStroke.Parent = equipBtn

-- Action buttons (IMPROVED)
local saveBtn = Instance.new("TextButton")
saveBtn.Size = UDim2.new(0.48, 0, 0, 42)
saveBtn.Position = UDim2.new(0, 10, 0, 150)
saveBtn.BackgroundColor3 = Color3.fromRGB(80, 200, 120)
saveBtn.Text = "üíæ SAVE"
saveBtn.TextSize = 14
saveBtn.Font = Enum.Font.GothamBold
saveBtn.TextColor3 = Color3.new(1, 1, 1)
saveBtn.BorderSizePixel = 0
saveBtn.ZIndex = 6
saveBtn.Parent = mainFrame

local saveCorner = Instance.new("UICorner")
saveCorner.CornerRadius = UDim.new(0, 10)
saveCorner.Parent = saveBtn

local saveStroke = Instance.new("UIStroke")
saveStroke.Color = Color3.fromRGB(100, 220, 140)
saveStroke.Thickness = 1.5
saveStroke.Transparency = 0.5
saveStroke.Parent = saveBtn

local quickTPBtn = Instance.new("TextButton")
quickTPBtn.Size = UDim2.new(0.48, 0, 0, 42)
quickTPBtn.Position = UDim2.new(0.52, 0, 0, 150)
quickTPBtn.BackgroundColor3 = Color3.fromRGB(255, 150, 50)
quickTPBtn.Text = "‚ö° QUICK TP"
quickTPBtn.TextSize = 14
quickTPBtn.Font = Enum.Font.GothamBold
quickTPBtn.TextColor3 = Color3.new(1, 1, 1)
quickTPBtn.BorderSizePixel = 0
quickTPBtn.ZIndex = 6
quickTPBtn.Parent = mainFrame

local quickCorner = Instance.new("UICorner")
quickCorner.CornerRadius = UDim.new(0, 10)
quickCorner.Parent = quickTPBtn

local quickStroke = Instance.new("UIStroke")
quickStroke.Color = Color3.fromRGB(255, 180, 80)
quickStroke.Thickness = 1.5
quickStroke.Transparency = 0.5
quickStroke.Parent = quickTPBtn

-- Settings (IMPROVED + NEW FEATURE)
local settingsFrame = Instance.new("Frame")
settingsFrame.Size = UDim2.new(1, -20, 0, 36)
settingsFrame.Position = UDim2.new(0, 10, 0, 202)
settingsFrame.BackgroundColor3 = Color3.fromRGB(22, 22, 32)
settingsFrame.BorderSizePixel = 0
settingsFrame.ZIndex = 6
settingsFrame.Parent = mainFrame

local settingsCorner = Instance.new("UICorner")
settingsCorner.CornerRadius = UDim.new(0, 8)
settingsCorner.Parent = settingsFrame

local settingsStroke = Instance.new("UIStroke")
settingsStroke.Color = Color3.fromRGB(60, 80, 150)
settingsStroke.Thickness = 1
settingsStroke.Transparency = 0.7
settingsStroke.Parent = settingsFrame

local antiBtn = Instance.new("TextButton")
antiBtn.Size = UDim2.new(0.32, -3, 1, -6)
antiBtn.Position = UDim2.new(0, 3, 0, 3)
antiBtn.BackgroundColor3 = Color3.fromRGB(80, 255, 100)
antiBtn.Text = "‚úì Anti"
antiBtn.TextSize = 11
antiBtn.Font = Enum.Font.GothamBold
antiBtn.TextColor3 = Color3.new(1, 1, 1)
antiBtn.BorderSizePixel = 0
antiBtn.ZIndex = 7
antiBtn.Parent = settingsFrame

local antiCorner = Instance.new("UICorner")
antiCorner.CornerRadius = UDim.new(0, 6)
antiCorner.Parent = antiBtn

local antiStroke = Instance.new("UIStroke")
antiStroke.Color = Color3.fromRGB(100, 255, 120)
antiStroke.Thickness = 1
antiStroke.Transparency = 0.5
antiStroke.Parent = antiBtn

local methodBtn = Instance.new("TextButton")
methodBtn.Size = UDim2.new(0.32, -3, 1, -6)
methodBtn.Position = UDim2.new(0.34, 1, 0, 3)
methodBtn.BackgroundColor3 = Color3.fromRGB(100, 150, 255)
methodBtn.Text = "‚ö° CFrame"
methodBtn.TextSize = 10
methodBtn.Font = Enum.Font.GothamBold
methodBtn.TextColor3 = Color3.new(1, 1, 1)
methodBtn.BorderSizePixel = 0
methodBtn.ZIndex = 7
methodBtn.Parent = settingsFrame

local methodCorner = Instance.new("UICorner")
methodCorner.CornerRadius = UDim.new(0, 6)
methodCorner.Parent = methodBtn

local methodStroke = Instance.new("UIStroke")
methodStroke.Color = Color3.fromRGB(120, 170, 255)
methodStroke.Thickness = 1
methodStroke.Transparency = 0.5
methodStroke.Parent = methodBtn

local clearBtn = Instance.new("TextButton")
clearBtn.Size = UDim2.new(0.32, -3, 1, -6)
clearBtn.Position = UDim2.new(0.68, 2, 0, 3)
clearBtn.BackgroundColor3 = Color3.fromRGB(255, 80, 80)
clearBtn.Text = "üóëÔ∏è Clear"
clearBtn.TextSize = 10
clearBtn.Font = Enum.Font.GothamBold
clearBtn.TextColor3 = Color3.new(1, 1, 1)
clearBtn.BorderSizePixel = 0
clearBtn.ZIndex = 7
clearBtn.Parent = settingsFrame

local clearCorner = Instance.new("UICorner")
clearCorner.CornerRadius = UDim.new(0, 6)
clearCorner.Parent = clearBtn

local clearStroke = Instance.new("UIStroke")
clearStroke.Color = Color3.fromRGB(255, 120, 120)
clearStroke.Thickness = 1
clearStroke.Transparency = 0.5
clearStroke.Parent = clearBtn

-- Locations header (IMPROVED)
local locHeader = Instance.new("TextLabel")
locHeader.Size = UDim2.new(1, -20, 0, 26)
locHeader.Position = UDim2.new(0, 10, 0, 248)
locHeader.BackgroundTransparency = 1
locHeader.Text = "üìç SAVED (0/20)"
locHeader.TextSize = 13
locHeader.Font = Enum.Font.GothamBold
locHeader.TextColor3 = Color3.fromRGB(220, 220, 220)
locHeader.TextXAlignment = Enum.TextXAlignment.Left
locHeader.ZIndex = 6
locHeader.Parent = mainFrame

-- NEW FEATURE: Export/Import buttons
local exportBtn = Instance.new("TextButton")
exportBtn.Size = UDim2.new(0, 50, 0, 22)
exportBtn.Position = UDim2.new(1, -115, 0, 2)
exportBtn.BackgroundColor3 = Color3.fromRGB(100, 180, 100)
exportBtn.Text = "üì§"
exportBtn.TextSize = 14
exportBtn.Font = Enum.Font.GothamBold
exportBtn.TextColor3 = Color3.new(1, 1, 1)
exportBtn.BorderSizePixel = 0
exportBtn.ZIndex = 7
exportBtn.Parent = locHeader

local expCorner = Instance.new("UICorner")
expCorner.CornerRadius = UDim.new(0, 6)
expCorner.Parent = exportBtn

local importBtn = Instance.new("TextButton")
importBtn.Size = UDim2.new(0, 50, 0, 22)
importBtn.Position = UDim2.new(1, -60, 0, 2)
importBtn.BackgroundColor3 = Color3.fromRGB(100, 150, 200)
importBtn.Text = "üì•"
importBtn.TextSize = 14
importBtn.Font = Enum.Font.GothamBold
importBtn.TextColor3 = Color3.new(1, 1, 1)
importBtn.BorderSizePixel = 0
importBtn.ZIndex = 7
importBtn.Parent = locHeader

local impCorner = Instance.new("UICorner")
impCorner.CornerRadius = UDim.new(0, 6)
impCorner.Parent = importBtn

-- Locations scroll (ADJUSTED)
local locScroll = Instance.new("ScrollingFrame")
locScroll.Size = UDim2.new(1, -20, 1, -284)
locScroll.Position = UDim2.new(0, 10, 0, 276)
locScroll.BackgroundColor3 = Color3.fromRGB(13, 13, 20)
locScroll.BorderSizePixel = 0
locScroll.ScrollBarThickness = 5
locScroll.ScrollBarImageColor3 = Color3.fromRGB(100, 150, 255)
locScroll.ZIndex = 6
locScroll.Parent = mainFrame

local scrollCorner = Instance.new("UICorner")
scrollCorner.CornerRadius = UDim.new(0, 8)
scrollCorner.Parent = locScroll

local scrollStroke = Instance.new("UIStroke")
scrollStroke.Color = Color3.fromRGB(40, 60, 100)
scrollStroke.Thickness = 1
scrollStroke.Transparency = 0.8
scrollStroke.Parent = locScroll

local scrollLayout = Instance.new("UIListLayout")
scrollLayout.Padding = UDim.new(0, 5)
scrollLayout.Parent = locScroll

local scrollPadding = Instance.new("UIPadding")
scrollPadding.PaddingTop = UDim.new(0, 5)
scrollPadding.PaddingLeft = UDim.new(0, 5)
scrollPadding.PaddingRight = UDim.new(0, 5)
scrollPadding.PaddingBottom = UDim.new(0, 5)
scrollPadding.Parent = locScroll

-- Open/Close logic
local isOpen = false

openBtn.MouseButton1Click:Connect(function()
	print("Button clicked! Current state:", isOpen)
	isOpen = not isOpen
	
	if isOpen then
		print("Opening panel...")
		mainFrame.Visible = true
		blur.Visible = true
	else
		print("Closing panel...")
		mainFrame.Visible = false
		blur.Visible = false
	end
end)

closeBtn.MouseButton1Click:Connect(function()
	print("Close button clicked!")
	isOpen = false
	mainFrame.Visible = false
	blur.Visible = false
end)

-- Settings buttons
antiBtn.MouseButton1Click:Connect(function()
	antiTPBack = not antiTPBack
	
	if antiTPBack then
		antiBtn.Text = "‚úì Anti"
		antiBtn.BackgroundColor3 = Color3.fromRGB(80, 255, 100)
	else
		antiBtn.Text = "‚úï Anti"
		antiBtn.BackgroundColor3 = Color3.fromRGB(255, 80, 80)
	end
end)

methodBtn.MouseButton1Click:Connect(function()
	if tpMethod == "cframe" then
		tpMethod = "tween"
		methodBtn.Text = "‚ú® Tween"
	elseif tpMethod == "tween" then
		tpMethod = "velocity"
		methodBtn.Text = "üöÄ Velocity"
	else
		tpMethod = "cframe"
		methodBtn.Text = "‚ö° CFrame"
	end
end)

clearBtn.MouseButton1Click:Connect(function()
	savedLocations = {}
	refreshList()
	updateBadge()
	
	clearBtn.Text = "‚úì Done"
	task.wait(0.5)
	clearBtn.Text = "üóëÔ∏è Clear"
end)

-- Update badge
function updateBadge()
	badgeText.Text = tostring(#savedLocations)
	locHeader.Text = "üìç SAVED (" .. #savedLocations .. "/20)"
end

-- Create location entry (MUCH BETTER DESIGN!)
function createEntry(location, index)
	local entry = Instance.new("Frame")
	entry.Size = UDim2.new(1, -10, 0, 58)
	entry.BackgroundColor3 = Color3.fromRGB(28, 28, 38)
	entry.BorderSizePixel = 0
	entry.ZIndex = 7
	entry.Parent = locScroll
	
	local entryCorner = Instance.new("UICorner")
	entryCorner.CornerRadius = UDim.new(0, 10)
	entryCorner.Parent = entry
	
	local entryStroke = Instance.new("UIStroke")
	entryStroke.Color = Color3.fromRGB(60, 100, 180)
	entryStroke.Thickness = 1.2
	entryStroke.Transparency = 0.7
	entryStroke.Parent = entry
	
	-- Gradient for depth
	local entryGradient = Instance.new("UIGradient")
	entryGradient.Color = ColorSequence.new({
		ColorSequenceKeypoint.new(0, Color3.fromRGB(32, 32, 42)),
		ColorSequenceKeypoint.new(1, Color3.fromRGB(24, 24, 34))
	})
	entryGradient.Rotation = 90
	entryGradient.Parent = entry
	
	local name = Instance.new("TextLabel")
	name.Size = UDim2.new(1, -80, 0, 19)
	name.Position = UDim2.new(0, 10, 0, 5)
	name.BackgroundTransparency = 1
	name.Text = location.name
	name.TextSize = 13
	name.Font = Enum.Font.GothamBold
	name.TextColor3 = Color3.fromRGB(120, 200, 255)
	name.TextXAlignment = Enum.TextXAlignment.Left
	name.ZIndex = 8
	name.Parent = entry
	
	local pos = Instance.new("TextLabel")
	pos.Size = UDim2.new(1, -80, 0, 14)
	pos.Position = UDim2.new(0, 10, 0, 24)
	pos.BackgroundTransparency = 1
	pos.Text = string.format("X:%.0f Y:%.0f Z:%.0f", location.position.X, location.position.Y, location.position.Z)
	pos.TextSize = 10
	pos.Font = Enum.Font.Gotham
	pos.TextColor3 = Color3.fromRGB(160, 160, 160)
	pos.TextXAlignment = Enum.TextXAlignment.Left
	pos.ZIndex = 8
	pos.Parent = entry
	
	local time = Instance.new("TextLabel")
	time.Size = UDim2.new(1, -80, 0, 14)
	time.Position = UDim2.new(0, 10, 0, 38)
	time.BackgroundTransparency = 1
	time.Text = "‚è∞ " .. location.time
	time.TextSize = 9
	time.Font = Enum.Font.Gotham
	time.TextColor3 = Color3.fromRGB(130, 130, 130)
	time.TextXAlignment = Enum.TextXAlignment.Left
	time.ZIndex = 8
	time.Parent = entry
	
	-- TP button (IMPROVED)
	local tpBtn = Instance.new("TextButton")
	tpBtn.Size = UDim2.new(0, 34, 0, 26)
	tpBtn.Position = UDim2.new(1, -72, 0, 12)
	tpBtn.BackgroundColor3 = Color3.fromRGB(100, 200, 255)
	tpBtn.Text = "‚Üí"
	tpBtn.TextSize = 17
	tpBtn.Font = Enum.Font.GothamBold
	tpBtn.TextColor3 = Color3.new(1, 1, 1)
	tpBtn.BorderSizePixel = 0
	tpBtn.ZIndex = 8
	tpBtn.Parent = entry
	
	local tpCorner = Instance.new("UICorner")
	tpCorner.CornerRadius = UDim.new(0, 7)
	tpCorner.Parent = tpBtn
	
	local tpStroke = Instance.new("UIStroke")
	tpStroke.Color = Color3.fromRGB(120, 220, 255)
	tpStroke.Thickness = 1.2
	tpStroke.Transparency = 0.5
	tpStroke.Parent = tpBtn
	
	-- Delete button (MUCH BETTER!)
	local delBtn = Instance.new("TextButton")
	delBtn.Size = UDim2.new(0, 34, 0, 26)
	delBtn.Position = UDim2.new(1, -35, 0, 12)
	delBtn.BackgroundColor3 = Color3.fromRGB(255, 80, 80)
	delBtn.Text = "‚úï"
	delBtn.TextSize = 15
	delBtn.Font = Enum.Font.GothamBold
	delBtn.TextColor3 = Color3.new(1, 1, 1)
	delBtn.BorderSizePixel = 0
	delBtn.ZIndex = 8
	delBtn.Parent = entry
	
	local delCorner = Instance.new("UICorner")
	delCorner.CornerRadius = UDim.new(0, 7)
	delCorner.Parent = delBtn
	
	local delStroke = Instance.new("UIStroke")
	delStroke.Color = Color3.fromRGB(255, 120, 120)
	delStroke.Thickness = 1.2
	delStroke.Transparency = 0.5
	delStroke.Parent = delBtn
	
	tpBtn.MouseButton1Click:Connect(function()
		teleportTo(location.position)
		tpBtn.BackgroundColor3 = Color3.fromRGB(80, 255, 100)
		task.wait(0.3)
		tpBtn.BackgroundColor3 = Color3.fromRGB(100, 200, 255)
	end)
	
	delBtn.MouseButton1Click:Connect(function()
		table.remove(savedLocations, index)
		refreshList()
		updateBadge()
	end)
end

function refreshList()
	for _, child in ipairs(locScroll:GetChildren()) do
		if child:IsA("Frame") then
			child:Destroy()
		end
	end
	
	for i, loc in ipairs(savedLocations) do
		createEntry(loc, i)
	end
	
	locScroll.CanvasSize = UDim2.new(0, 0, 0, #savedLocations * 63)
end

-- NEW FEATURE: Export locations
exportBtn.MouseButton1Click:Connect(function()
	if #savedLocations == 0 then
		exportBtn.Text = "‚ùå"
		task.wait(0.5)
		exportBtn.Text = "üì§"
		return
	end
	
	local exportData = game:GetService("HttpService"):JSONEncode(savedLocations)
	setclipboard(exportData)
	
	exportBtn.Text = "‚úì"
	exportBtn.BackgroundColor3 = Color3.fromRGB(80, 255, 100)
	task.wait(0.8)
	exportBtn.Text = "üì§"
	exportBtn.BackgroundColor3 = Color3.fromRGB(100, 180, 100)
	
	-- Show notification
	local notif = Instance.new("TextLabel")
	notif.Size = UDim2.new(0, 220, 0, 40)
	notif.Position = UDim2.new(0.5, -110, 0.5, -20)
	notif.BackgroundColor3 = Color3.fromRGB(80, 200, 120)
	notif.Text = "‚úì Copied to clipboard!"
	notif.TextSize = 13
	notif.Font = Enum.Font.GothamBold
	notif.TextColor3 = Color3.new(1, 1, 1)
	notif.BorderSizePixel = 0
	notif.ZIndex = 100
	notif.Parent = gui
	
	local notifCorner = Instance.new("UICorner")
	notifCorner.CornerRadius = UDim.new(0, 10)
	notifCorner.Parent = notif
	
	task.wait(2)
	notif:Destroy()
end)

-- NEW FEATURE: Import locations
importBtn.MouseButton1Click:Connect(function()
	local success, importData = pcall(function()
		return game:GetService("HttpService"):JSONDecode(getclipboard())
	end)
	
	if success and type(importData) == "table" then
		savedLocations = importData
		refreshList()
		updateBadge()
		
		importBtn.Text = "‚úì"
		importBtn.BackgroundColor3 = Color3.fromRGB(80, 255, 100)
		task.wait(0.8)
		importBtn.Text = "üì•"
		importBtn.BackgroundColor3 = Color3.fromRGB(100, 150, 200)
	else
		importBtn.Text = "‚ùå"
		task.wait(0.8)
		importBtn.Text = "üì•"
	end
end)
saveBtn.MouseButton1Click:Connect(function()
	if not hrp then
		saveBtn.Text = "‚ùå NO CHAR"
		task.wait(1)
		saveBtn.Text = "üíæ SAVE"
		return
	end
	
	if #savedLocations >= MAX_LOCATIONS then
		saveBtn.Text = "‚ö†Ô∏è FULL"
		task.wait(1)
		saveBtn.Text = "üíæ SAVE"
		return
	end
	
	table.insert(savedLocations, {
		name = "Location #" .. (#savedLocations + 1),
		position = hrp.Position,
		time = os.date("%H:%M:%S")
	})
	
	refreshList()
	updateBadge()
	
	saveBtn.Text = "‚úì SAVED"
	saveBtn.BackgroundColor3 = Color3.fromRGB(80, 255, 100)
	task.wait(0.5)
	saveBtn.Text = "üíæ SAVE"
	saveBtn.BackgroundColor3 = Color3.fromRGB(80, 200, 120)
end)

-- Quick TP (FIXED - ACCURATE!)
local quickMode = false
quickTPBtn.MouseButton1Click:Connect(function()
	quickMode = true
	quickTPBtn.Text = "üëÜ TAP NOW"
	quickTPBtn.BackgroundColor3 = Color3.fromRGB(255, 80, 80)
	
	isOpen = false
	mainFrame.Visible = false
	blur.Visible = false
	
	local conn
	conn = UserInputService.InputBegan:Connect(function(input, gpe)
		if not gpe and quickMode then
			if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseButton1 then
				-- Use proper mouse position function
				local targetPos = getMousePosition(input.Position)
				
				if targetPos then
					teleportTo(targetPos)
				end
				
				quickMode = false
				quickTPBtn.Text = "‚ö° QUICK TP"
				quickTPBtn.BackgroundColor3 = Color3.fromRGB(255, 150, 50)
				conn:Disconnect()
			end
		end
	end)
	
	task.wait(10)
	if quickMode then
		quickMode = false
		quickTPBtn.Text = "‚ö° QUICK TP"
		quickTPBtn.BackgroundColor3 = Color3.fromRGB(255, 150, 50)
		conn:Disconnect()
	end
end)

-- Equip TP Tool (FIXED - ACCURATE!)
local toolIndicator = Instance.new("TextLabel")
toolIndicator.Size = UDim2.new(0, 180, 0, 35)
toolIndicator.Position = UDim2.new(0.5, -90, 0, 15)
toolIndicator.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
toolIndicator.BackgroundTransparency = 0.3
toolIndicator.Text = "üéØ TAP TO TP"
toolIndicator.TextSize = 13
toolIndicator.Font = Enum.Font.GothamBold
toolIndicator.TextColor3 = Color3.fromRGB(100, 255, 150)
toolIndicator.BorderSizePixel = 0
toolIndicator.Visible = false
toolIndicator.ZIndex = 50
toolIndicator.Parent = gui

local indCorner = Instance.new("UICorner")
indCorner.CornerRadius = UDim.new(0, 10)
indCorner.Parent = toolIndicator

local indStroke = Instance.new("UIStroke")
indStroke.Color = Color3.fromRGB(100, 255, 150)
indStroke.Thickness = 2
indStroke.Parent = toolIndicator

equipBtn.MouseButton1Click:Connect(function()
	toolEquipped = not toolEquipped
	
	if toolEquipped then
		equipBtn.Text = "UNEQUIP"
		equipBtn.BackgroundColor3 = Color3.fromRGB(255, 80, 80)
		toolIndicator.Visible = true
		
		isOpen = false
		mainFrame.Visible = false
		blur.Visible = false
	else
		equipBtn.Text = "EQUIP"
		equipBtn.BackgroundColor3 = Color3.fromRGB(70, 160, 255)
		toolIndicator.Visible = false
	end
end)

-- TP Tool tap detection (FIXED - ACCURATE!)
UserInputService.InputBegan:Connect(function(input, gpe)
	if not gpe and toolEquipped then
		if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseButton1 then
			-- Use proper mouse position function
			local targetPos = getMousePosition(input.Position)
			
			if targetPos then
				teleportTo(targetPos)
				
				-- Visual feedback
				local effect = Instance.new("Part")
				effect.Size = Vector3.new(2, 0.2, 2)
				effect.Position = targetPos
				effect.Anchored = true
				effect.CanCollide = false
				effect.Material = Enum.Material.Neon
				effect.Color = Color3.fromRGB(100, 200, 255)
				effect.Transparency = 0.5
				effect.Parent = workspace
				
				game:GetService("Debris"):AddItem(effect, 1)
				
				TweenService:Create(effect, TweenInfo.new(1), {
					Size = Vector3.new(6, 0.2, 6),
					Transparency = 1
				}):Play()
			end
		end
	end
end)

-- PROPER TP FUNCTION (INFINITE YIELD STYLE - ACCURATE!)
function teleportTo(targetPos)
	if not hrp or not humanoid then return end
	
	-- Infinite Yield method: Teleport to position above target first, then drop down
	local safePos = targetPos + Vector3.new(0, 5, 0)
	
	if tpMethod == "cframe" then
		-- Disable network ownership temporarily
		if antiTPBack then
			-- Set network ownership
			pcall(function()
				hrp.AssemblyLinearVelocity = Vector3.zero
				hrp.AssemblyAngularVelocity = Vector3.zero
			end)
			
			hrp.CFrame = CFrame.new(safePos)
			hrp.Anchored = true
			
			task.wait(0.1)
			
			hrp.Anchored = false
			
			-- Wait a bit for physics to settle
			task.wait(0.05)
		else
			hrp.CFrame = CFrame.new(safePos)
		end
		
	elseif tpMethod == "tween" then
		-- Smooth tween
		local tweenInfo = TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
		local tween = TweenService:Create(hrp, tweenInfo, {CFrame = CFrame.new(safePos)})
		
		if antiTPBack then
			humanoid.PlatformStand = true
		end
		
		tween:Play()
		tween.Completed:Wait()
		
		if antiTPBack then
			task.wait(0.05)
			humanoid.PlatformStand = false
		end
		
	elseif tpMethod == "velocity" then
		-- Velocity-based
		local direction = (safePos - hrp.Position).Unit
		local distance = (safePos - hrp.Position).Magnitude
		
		local bodyVel = Instance.new("BodyVelocity")
		bodyVel.MaxForce = Vector3.new(100000, 100000, 100000)
		bodyVel.Velocity = direction * math.min(distance * 3, 250)
		bodyVel.Parent = hrp
		
		if antiTPBack then
			humanoid.PlatformStand = true
		end
		
		task.wait(0.4)
		bodyVel:Destroy()
		
		if antiTPBack then
			task.wait(0.05)
			humanoid.PlatformStand = false
		end
	end
end

-- ACCURATE MOUSE/TAP TO POSITION (INFINITE YIELD METHOD)
function getMousePosition(inputPos)
	local camera = workspace.CurrentCamera
	
	-- Create ray from camera through mouse/tap position
	local unitRay = camera:ViewportPointToRay(inputPos.X, inputPos.Y)
	
	-- Raycast parameters
	local raycastParams = RaycastParams.new()
	raycastParams.FilterDescendantsInstances = {character}
	raycastParams.FilterType = Enum.RaycastFilterType.Blacklist
	raycastParams.IgnoreWater = false
	
	-- Cast ray 1000 studs
	local rayResult = workspace:Raycast(unitRay.Origin, unitRay.Direction * 1000, raycastParams)
	
	if rayResult then
		-- Return the EXACT position where ray hit
		return rayResult.Position
	else
		-- If no hit, return position 1000 studs away in that direction
		return unitRay.Origin + (unitRay.Direction * 1000)
	end
end

-- Initialize
updateBadge()

print("==========================================")
print("Universal Teleport [FIXED VERSION]")
print("==========================================")
print("‚úÖ Draggable button (bottom right)")
print("‚úÖ Click button to open menu")
print("‚úÖ TP Tool - Equip and tap anywhere")
print("‚úÖ Quick TP - One-time tap teleport")
print("‚úÖ Save up to 20 locations")
print("‚úÖ Anti TP-back protection")
print("==========================================")
print("üí° Button is draggable!")
print("üí° Menu opens when you click it!")
print("==========================================")
