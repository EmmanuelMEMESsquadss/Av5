-- LocalScript (StarterPlayerScripts)
-- Universal Teleport System [FIXED - ACTUALLY WORKS]

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local character, humanoid, hrp

local savedLocations = {}
local MAX_LOCATIONS = 20
local antiTPBack = true
local tpMethod = "cframe"
local toolEquipped = false

local function setupCharacter(char)
	character = char
	humanoid = char:WaitForChild("Humanoid")
	hrp = char:FindFirstChild("HumanoidRootPart") or char:WaitForChild("HumanoidRootPart")
end

if player.Character then setupCharacter(player.Character) end
player.CharacterAdded:Connect(setupCharacter)

-- GUI
local gui = Instance.new("ScreenGui")
gui.Name = "UniversalTeleportUI"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

-- Draggable button
local openBtn = Instance.new("TextButton")
openBtn.Size = UDim2.new(0, 60, 0, 60)
openBtn.Position = UDim2.new(1, -75, 1, -75)
openBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
openBtn.Text = "üìç"
openBtn.TextSize = 28
openBtn.Font = Enum.Font.GothamBold
openBtn.TextColor3 = Color3.fromRGB(100, 200, 255)
openBtn.BorderSizePixel = 0
openBtn.Active = true
openBtn.Draggable = true
openBtn.ZIndex = 10
openBtn.Parent = gui

local btnCorner = Instance.new("UICorner")
btnCorner.CornerRadius = UDim.new(0.3, 0)
btnCorner.Parent = openBtn

local btnStroke = Instance.new("UIStroke")
btnStroke.Color = Color3.fromRGB(100, 200, 255)
btnStroke.Thickness = 2
btnStroke.Parent = openBtn

-- Badge
local badge = Instance.new("Frame")
badge.Size = UDim2.new(0, 20, 0, 20)
badge.Position = UDim2.new(1, -8, 0, -8)
badge.BackgroundColor3 = Color3.fromRGB(255, 70, 70)
badge.BorderSizePixel = 0
badge.ZIndex = 11
badge.Parent = openBtn

local badgeCorner = Instance.new("UICorner")
badgeCorner.CornerRadius = UDim.new(1, 0)
badgeCorner.Parent = badge

local badgeText = Instance.new("TextLabel")
badgeText.Size = UDim2.new(1, 0, 1, 0)
badgeText.BackgroundTransparency = 1
badgeText.Text = "0"
badgeText.TextSize = 10
badgeText.Font = Enum.Font.GothamBold
badgeText.TextColor3 = Color3.new(1, 1, 1)
badgeText.ZIndex = 12
badgeText.Parent = badge

-- Main Frame
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 350, 0, 500)
mainFrame.Position = UDim2.new(0.5, -175, 0.5, -250)
mainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 28)
mainFrame.BorderSizePixel = 0
mainFrame.Visible = false
mainFrame.ZIndex = 5
mainFrame.Parent = gui

local frameCorner = Instance.new("UICorner")
frameCorner.CornerRadius = UDim.new(0, 12)
frameCorner.Parent = mainFrame

local frameStroke = Instance.new("UIStroke")
frameStroke.Color = Color3.fromRGB(80, 120, 200)
frameStroke.Thickness = 2
frameStroke.Parent = mainFrame

-- Background blur
local blur = Instance.new("Frame")
blur.Size = UDim2.new(1, 0, 1, 0)
blur.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
blur.BackgroundTransparency = 0.5
blur.BorderSizePixel = 0
blur.Visible = false
blur.ZIndex = 4
blur.Parent = gui

-- Top bar
local topBar = Instance.new("Frame")
topBar.Size = UDim2.new(1, 0, 0, 50)
topBar.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
topBar.BorderSizePixel = 0
topBar.ZIndex = 6
topBar.Parent = mainFrame

local topCorner = Instance.new("UICorner")
topCorner.CornerRadius = UDim.new(0, 12)
topCorner.Parent = topBar

-- Title
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -60, 1, 0)
title.Position = UDim2.new(0, 15, 0, 0)
title.BackgroundTransparency = 1
title.Text = "üåê TELEPORT"
title.TextSize = 18
title.Font = Enum.Font.GothamBold
title.TextColor3 = Color3.fromRGB(100, 200, 255)
title.TextXAlignment = Enum.TextXAlignment.Left
title.ZIndex = 7
title.Parent = topBar

-- Close button
local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0, 40, 0, 40)
closeBtn.Position = UDim2.new(1, -45, 0, 5)
closeBtn.BackgroundColor3 = Color3.fromRGB(255, 60, 60)
closeBtn.Text = "‚úï"
closeBtn.TextSize = 18
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextColor3 = Color3.new(1, 1, 1)
closeBtn.BorderSizePixel = 0
closeBtn.ZIndex = 7
closeBtn.Parent = topBar

local closeCorner = Instance.new("UICorner")
closeCorner.CornerRadius = UDim.new(0.2, 0)
closeCorner.Parent = closeBtn

-- TP Tool Section
local toolFrame = Instance.new("Frame")
toolFrame.Size = UDim2.new(1, -20, 0, 80)
toolFrame.Position = UDim2.new(0, 10, 0, 60)
toolFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
toolFrame.BorderSizePixel = 0
toolFrame.ZIndex = 6
toolFrame.Parent = mainFrame

local toolFrameCorner = Instance.new("UICorner")
toolFrameCorner.CornerRadius = UDim.new(0, 10)
toolFrameCorner.Parent = toolFrame

local toolIcon = Instance.new("TextLabel")
toolIcon.Size = UDim2.new(0, 50, 0, 50)
toolIcon.Position = UDim2.new(0, 10, 0, 15)
toolIcon.BackgroundTransparency = 1
toolIcon.Text = "üéØ"
toolIcon.TextSize = 35
toolIcon.ZIndex = 7
toolIcon.Parent = toolFrame

local toolTitle = Instance.new("TextLabel")
toolTitle.Size = UDim2.new(1, -170, 0, 25)
toolTitle.Position = UDim2.new(0, 65, 0, 12)
toolTitle.BackgroundTransparency = 1
toolTitle.Text = "TP TOOL"
toolTitle.TextSize = 14
toolTitle.Font = Enum.Font.GothamBold
toolTitle.TextColor3 = Color3.fromRGB(100, 200, 255)
toolTitle.TextXAlignment = Enum.TextXAlignment.Left
toolTitle.ZIndex = 7
toolTitle.Parent = toolFrame

local toolDesc = Instance.new("TextLabel")
toolDesc.Size = UDim2.new(1, -170, 0, 30)
toolDesc.Position = UDim2.new(0, 65, 0, 35)
toolDesc.BackgroundTransparency = 1
toolDesc.Text = "Tap anywhere to teleport"
toolDesc.TextSize = 11
toolDesc.Font = Enum.Font.Gotham
toolDesc.TextColor3 = Color3.fromRGB(150, 150, 150)
toolDesc.TextXAlignment = Enum.TextXAlignment.Left
toolDesc.TextWrapped = true
toolDesc.ZIndex = 7
toolDesc.Parent = toolFrame

local equipBtn = Instance.new("TextButton")
equipBtn.Size = UDim2.new(0, 80, 0, 30)
equipBtn.Position = UDim2.new(1, -90, 0, 25)
equipBtn.BackgroundColor3 = Color3.fromRGB(60, 150, 255)
equipBtn.Text = "EQUIP"
equipBtn.TextSize = 12
equipBtn.Font = Enum.Font.GothamBold
equipBtn.TextColor3 = Color3.new(1, 1, 1)
equipBtn.BorderSizePixel = 0
equipBtn.ZIndex = 7
equipBtn.Parent = toolFrame

local equipCorner = Instance.new("UICorner")
equipCorner.CornerRadius = UDim.new(0, 8)
equipCorner.Parent = equipBtn

-- Action buttons
local saveBtn = Instance.new("TextButton")
saveBtn.Size = UDim2.new(0.48, 0, 0, 40)
saveBtn.Position = UDim2.new(0, 10, 0, 150)
saveBtn.BackgroundColor3 = Color3.fromRGB(80, 200, 120)
saveBtn.Text = "üíæ SAVE"
saveBtn.TextSize = 14
saveBtn.Font = Enum.Font.GothamBold
saveBtn.TextColor3 = Color3.new(1, 1, 1)
saveBtn.BorderSizePixel = 0
saveBtn.ZIndex = 6
saveBtn.Parent = mainFrame

local saveCorner = Instance.new("UICorner")
saveCorner.CornerRadius = UDim.new(0, 10)
saveCorner.Parent = saveBtn

local quickTPBtn = Instance.new("TextButton")
quickTPBtn.Size = UDim2.new(0.48, 0, 0, 40)
quickTPBtn.Position = UDim2.new(0.52, 0, 0, 150)
quickTPBtn.BackgroundColor3 = Color3.fromRGB(255, 150, 50)
quickTPBtn.Text = "‚ö° QUICK TP"
quickTPBtn.TextSize = 14
quickTPBtn.Font = Enum.Font.GothamBold
quickTPBtn.TextColor3 = Color3.new(1, 1, 1)
quickTPBtn.BorderSizePixel = 0
quickTPBtn.ZIndex = 6
quickTPBtn.Parent = mainFrame

local quickCorner = Instance.new("UICorner")
quickCorner.CornerRadius = UDim.new(0, 10)
quickCorner.Parent = quickTPBtn

-- Settings
local settingsFrame = Instance.new("Frame")
settingsFrame.Size = UDim2.new(1, -20, 0, 35)
settingsFrame.Position = UDim2.new(0, 10, 0, 200)
settingsFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
settingsFrame.BorderSizePixel = 0
settingsFrame.ZIndex = 6
settingsFrame.Parent = mainFrame

local settingsCorner = Instance.new("UICorner")
settingsCorner.CornerRadius = UDim.new(0, 8)
settingsCorner.Parent = settingsFrame

local antiBtn = Instance.new("TextButton")
antiBtn.Size = UDim2.new(0.32, -3, 1, -6)
antiBtn.Position = UDim2.new(0, 3, 0, 3)
antiBtn.BackgroundColor3 = Color3.fromRGB(80, 255, 100)
antiBtn.Text = "‚úì Anti"
antiBtn.TextSize = 11
antiBtn.Font = Enum.Font.GothamBold
antiBtn.TextColor3 = Color3.new(1, 1, 1)
antiBtn.BorderSizePixel = 0
antiBtn.ZIndex = 7
antiBtn.Parent = settingsFrame

local antiCorner = Instance.new("UICorner")
antiCorner.CornerRadius = UDim.new(0, 6)
antiCorner.Parent = antiBtn

local methodBtn = Instance.new("TextButton")
methodBtn.Size = UDim2.new(0.32, -3, 1, -6)
methodBtn.Position = UDim2.new(0.34, 1, 0, 3)
methodBtn.BackgroundColor3 = Color3.fromRGB(100, 150, 255)
methodBtn.Text = "‚ö° CFrame"
methodBtn.TextSize = 10
methodBtn.Font = Enum.Font.GothamBold
methodBtn.TextColor3 = Color3.new(1, 1, 1)
methodBtn.BorderSizePixel = 0
methodBtn.ZIndex = 7
methodBtn.Parent = settingsFrame

local methodCorner = Instance.new("UICorner")
methodCorner.CornerRadius = UDim.new(0, 6)
methodCorner.Parent = methodBtn

local clearBtn = Instance.new("TextButton")
clearBtn.Size = UDim2.new(0.32, -3, 1, -6)
clearBtn.Position = UDim2.new(0.68, 2, 0, 3)
clearBtn.BackgroundColor3 = Color3.fromRGB(255, 80, 80)
clearBtn.Text = "üóëÔ∏è Clear"
clearBtn.TextSize = 11
clearBtn.Font = Enum.Font.GothamBold
clearBtn.TextColor3 = Color3.new(1, 1, 1)
clearBtn.BorderSizePixel = 0
clearBtn.ZIndex = 7
clearBtn.Parent = settingsFrame

local clearCorner = Instance.new("UICorner")
clearCorner.CornerRadius = UDim.new(0, 6)
clearCorner.Parent = clearBtn

-- Locations header
local locHeader = Instance.new("TextLabel")
locHeader.Size = UDim2.new(1, -20, 0, 25)
locHeader.Position = UDim2.new(0, 10, 0, 245)
locHeader.BackgroundTransparency = 1
locHeader.Text = "üìç SAVED (0/20)"
locHeader.TextSize = 13
locHeader.Font = Enum.Font.GothamBold
locHeader.TextColor3 = Color3.fromRGB(200, 200, 200)
locHeader.TextXAlignment = Enum.TextXAlignment.Left
locHeader.ZIndex = 6
locHeader.Parent = mainFrame

-- Locations scroll
local locScroll = Instance.new("ScrollingFrame")
locScroll.Size = UDim2.new(1, -20, 1, -280)
locScroll.Position = UDim2.new(0, 10, 0, 270)
locScroll.BackgroundColor3 = Color3.fromRGB(15, 15, 22)
locScroll.BorderSizePixel = 0
locScroll.ScrollBarThickness = 6
locScroll.ScrollBarImageColor3 = Color3.fromRGB(100, 150, 255)
locScroll.ZIndex = 6
locScroll.Parent = mainFrame

local scrollCorner = Instance.new("UICorner")
scrollCorner.CornerRadius = UDim.new(0, 8)
scrollCorner.Parent = locScroll

local scrollLayout = Instance.new("UIListLayout")
scrollLayout.Padding = UDim.new(0, 5)
scrollLayout.Parent = locScroll

local scrollPadding = Instance.new("UIPadding")
scrollPadding.PaddingTop = UDim.new(0, 5)
scrollPadding.PaddingLeft = UDim.new(0, 5)
scrollPadding.PaddingRight = UDim.new(0, 5)
scrollPadding.PaddingBottom = UDim.new(0, 5)
scrollPadding.Parent = locScroll

-- Open/Close logic
local isOpen = false

openBtn.MouseButton1Click:Connect(function()
	print("Button clicked! Current state:", isOpen)
	isOpen = not isOpen
	
	if isOpen then
		print("Opening panel...")
		mainFrame.Visible = true
		blur.Visible = true
	else
		print("Closing panel...")
		mainFrame.Visible = false
		blur.Visible = false
	end
end)

closeBtn.MouseButton1Click:Connect(function()
	print("Close button clicked!")
	isOpen = false
	mainFrame.Visible = false
	blur.Visible = false
end)

-- Settings buttons
antiBtn.MouseButton1Click:Connect(function()
	antiTPBack = not antiTPBack
	
	if antiTPBack then
		antiBtn.Text = "‚úì Anti"
		antiBtn.BackgroundColor3 = Color3.fromRGB(80, 255, 100)
	else
		antiBtn.Text = "‚úï Anti"
		antiBtn.BackgroundColor3 = Color3.fromRGB(255, 80, 80)
	end
end)

methodBtn.MouseButton1Click:Connect(function()
	if tpMethod == "cframe" then
		tpMethod = "tween"
		methodBtn.Text = "‚ú® Tween"
	elseif tpMethod == "tween" then
		tpMethod = "velocity"
		methodBtn.Text = "üöÄ Velocity"
	else
		tpMethod = "cframe"
		methodBtn.Text = "‚ö° CFrame"
	end
end)

clearBtn.MouseButton1Click:Connect(function()
	savedLocations = {}
	refreshList()
	updateBadge()
	
	clearBtn.Text = "‚úì Done"
	task.wait(0.5)
	clearBtn.Text = "üóëÔ∏è Clear"
end)

-- Update badge
function updateBadge()
	badgeText.Text = tostring(#savedLocations)
	locHeader.Text = "üìç SAVED (" .. #savedLocations .. "/20)"
end

-- Create location entry
function createEntry(location, index)
	local entry = Instance.new("Frame")
	entry.Size = UDim2.new(1, -10, 0, 60)
	entry.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
	entry.BorderSizePixel = 0
	entry.ZIndex = 7
	entry.Parent = locScroll
	
	local entryCorner = Instance.new("UICorner")
	entryCorner.CornerRadius = UDim.new(0, 8)
	entryCorner.Parent = entry
	
	local name = Instance.new("TextLabel")
	name.Size = UDim2.new(1, -80, 0, 20)
	name.Position = UDim2.new(0, 10, 0, 5)
	name.BackgroundTransparency = 1
	name.Text = location.name
	name.TextSize = 13
	name.Font = Enum.Font.GothamBold
	name.TextColor3 = Color3.fromRGB(100, 200, 255)
	name.TextXAlignment = Enum.TextXAlignment.Left
	name.ZIndex = 8
	name.Parent = entry
	
	local pos = Instance.new("TextLabel")
	pos.Size = UDim2.new(1, -80, 0, 15)
	pos.Position = UDim2.new(0, 10, 0, 25)
	pos.BackgroundTransparency = 1
	pos.Text = string.format("X:%.0f Y:%.0f Z:%.0f", location.position.X, location.position.Y, location.position.Z)
	pos.TextSize = 10
	pos.Font = Enum.Font.Gotham
	pos.TextColor3 = Color3.fromRGB(150, 150, 150)
	pos.TextXAlignment = Enum.TextXAlignment.Left
	pos.ZIndex = 8
	pos.Parent = entry
	
	local time = Instance.new("TextLabel")
	time.Size = UDim2.new(1, -80, 0, 15)
	time.Position = UDim2.new(0, 10, 0, 40)
	time.BackgroundTransparency = 1
	time.Text = "‚è∞ " .. location.time
	time.TextSize = 9
	time.Font = Enum.Font.Gotham
	time.TextColor3 = Color3.fromRGB(120, 120, 120)
	time.TextXAlignment = Enum.TextXAlignment.Left
	time.ZIndex = 8
	time.Parent = entry
	
	local tpBtn = Instance.new("TextButton")
	tpBtn.Size = UDim2.new(0, 32, 0, 25)
	tpBtn.Position = UDim2.new(1, -70, 0, 10)
	tpBtn.BackgroundColor3 = Color3.fromRGB(100, 200, 255)
	tpBtn.Text = "‚Üí"
	tpBtn.TextSize = 16
	tpBtn.Font = Enum.Font.GothamBold
	tpBtn.TextColor3 = Color3.new(1, 1, 1)
	tpBtn.BorderSizePixel = 0
	tpBtn.ZIndex = 8
	tpBtn.Parent = entry
	
	local tpCorner = Instance.new("UICorner")
	tpCorner.CornerRadius = UDim.new(0, 6)
	tpCorner.Parent = tpBtn
	
	local delBtn = Instance.new("TextButton")
	delBtn.Size = UDim2.new(0, 32, 0, 25)
	delBtn.Position = UDim2.new(1, -35, 0, 10)
	delBtn.BackgroundColor3 = Color3.fromRGB(255, 80, 80)
	delBtn.Text = "‚úï"
	delBtn.TextSize = 14
	delBtn.Font = Enum.Font.GothamBold
	delBtn.TextColor3 = Color3.new(1, 1, 1)
	delBtn.BorderSizePixel = 0
	delBtn.ZIndex = 8
	delBtn.Parent = entry
	
	local delCorner = Instance.new("UICorner")
	delCorner.CornerRadius = UDim.new(0, 6)
	delCorner.Parent = delBtn
	
	tpBtn.MouseButton1Click:Connect(function()
		teleportTo(location.position)
		tpBtn.BackgroundColor3 = Color3.fromRGB(80, 255, 100)
		task.wait(0.3)
		tpBtn.BackgroundColor3 = Color3.fromRGB(100, 200, 255)
	end)
	
	delBtn.MouseButton1Click:Connect(function()
		table.remove(savedLocations, index)
		refreshList()
		updateBadge()
	end)
end

function refreshList()
	for _, child in ipairs(locScroll:GetChildren()) do
		if child:IsA("Frame") then
			child:Destroy()
		end
	end
	
	for i, loc in ipairs(savedLocations) do
		createEntry(loc, i)
	end
	
	locScroll.CanvasSize = UDim2.new(0, 0, 0, #savedLocations * 65)
end

-- Save location
saveBtn.MouseButton1Click:Connect(function()
	if not hrp then
		saveBtn.Text = "‚ùå NO CHAR"
		task.wait(1)
		saveBtn.Text = "üíæ SAVE"
		return
	end
	
	if #savedLocations >= MAX_LOCATIONS then
		saveBtn.Text = "‚ö†Ô∏è FULL"
		task.wait(1)
		saveBtn.Text = "üíæ SAVE"
		return
	end
	
	table.insert(savedLocations, {
		name = "Location #" .. (#savedLocations + 1),
		position = hrp.Position,
		time = os.date("%H:%M:%S")
	})
	
	refreshList()
	updateBadge()
	
	saveBtn.Text = "‚úì SAVED"
	saveBtn.BackgroundColor3 = Color3.fromRGB(80, 255, 100)
	task.wait(0.5)
	saveBtn.Text = "üíæ SAVE"
	saveBtn.BackgroundColor3 = Color3.fromRGB(80, 200, 120)
end)

-- Quick TP
local quickMode = false
quickTPBtn.MouseButton1Click:Connect(function()
	quickMode = true
	quickTPBtn.Text = "üëÜ TAP NOW"
	quickTPBtn.BackgroundColor3 = Color3.fromRGB(255, 80, 80)
	
	isOpen = false
	mainFrame.Visible = false
	blur.Visible = false
	
	local conn
	conn = UserInputService.InputBegan:Connect(function(input, gpe)
		if not gpe and quickMode then
			if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseButton1 then
				local camera = workspace.CurrentCamera
				local ray = camera:ViewportPointToRay(input.Position.X, input.Position.Y)
				local params = RaycastParams.new()
				params.FilterDescendantsInstances = {character}
				params.FilterType = Enum.RaycastFilterType.Blacklist
				
				local result = workspace:Raycast(ray.Origin, ray.Direction * 1000, params)
				
				if result then
					teleportTo(result.Position)
				end
				
				quickMode = false
				quickTPBtn.Text = "‚ö° QUICK TP"
				quickTPBtn.BackgroundColor3 = Color3.fromRGB(255, 150, 50)
				conn:Disconnect()
			end
		end
	end)
	
	task.wait(10)
	if quickMode then
		quickMode = false
		quickTPBtn.Text = "‚ö° QUICK TP"
		quickTPBtn.BackgroundColor3 = Color3.fromRGB(255, 150, 50)
		conn:Disconnect()
	end
end)

-- Equip TP Tool
local toolIndicator = Instance.new("TextLabel")
toolIndicator.Size = UDim2.new(0, 180, 0, 35)
toolIndicator.Position = UDim2.new(0.5, -90, 0, 15)
toolIndicator.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
toolIndicator.BackgroundTransparency = 0.3
toolIndicator.Text = "üéØ TAP TO TP"
toolIndicator.TextSize = 13
toolIndicator.Font = Enum.Font.GothamBold
toolIndicator.TextColor3 = Color3.fromRGB(100, 255, 150)
toolIndicator.BorderSizePixel = 0
toolIndicator.Visible = false
toolIndicator.ZIndex = 50
toolIndicator.Parent = gui

local indCorner = Instance.new("UICorner")
indCorner.CornerRadius = UDim.new(0, 10)
indCorner.Parent = toolIndicator

local indStroke = Instance.new("UIStroke")
indStroke.Color = Color3.fromRGB(100, 255, 150)
indStroke.Thickness = 2
indStroke.Parent = toolIndicator

equipBtn.MouseButton1Click:Connect(function()
	toolEquipped = not toolEquipped
	
	if toolEquipped then
		equipBtn.Text = "UNEQUIP"
		equipBtn.BackgroundColor3 = Color3.fromRGB(255, 80, 80)
		toolIndicator.Visible = true
		
		isOpen = false
		mainFrame.Visible = false
		blur.Visible = false
	else
		equipBtn.Text = "EQUIP"
		equipBtn.BackgroundColor3 = Color3.fromRGB(60, 150, 255)
		toolIndicator.Visible = false
	end
end)

-- TP Tool tap detection
UserInputService.InputBegan:Connect(function(input, gpe)
	if not gpe and toolEquipped then
		if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseButton1 then
			local camera = workspace.CurrentCamera
			local ray = camera:ViewportPointToRay(input.Position.X, input.Position.Y)
			local params = RaycastParams.new()
			params.FilterDescendantsInstances = {character}
			params.FilterType = Enum.RaycastFilterType.Blacklist
			
			local result = workspace:Raycast(ray.Origin, ray.Direction * 1000, params)
			
			if result then
				teleportTo(result.Position)
			end
		end
	end
end)

-- TELEPORT FUNCTION
function teleportTo(targetPos)
	if not hrp or not humanoid then return end
	
	local targetCFrame = CFrame.new(targetPos + Vector3.new(0, 3, 0))
	
	if tpMethod == "cframe" then
		if antiTPBack then
			hrp.CFrame = targetCFrame
			hrp.Anchored = true
			task.wait(0.1)
			hrp.Anchored = false
		else
			hrp.CFrame = targetCFrame
		end
		
	elseif tpMethod == "tween" then
		local tween = TweenService:Create(hrp, TweenInfo.new(0.5), {CFrame = targetCFrame})
		if antiTPBack then humanoid.PlatformStand = true end
		tween:Play()
		tween.Completed:Wait()
		if antiTPBack then humanoid.PlatformStand = false end
		
	elseif tpMethod == "velocity" then
		local direction = (targetPos - hrp.Position).Unit
		local distance = (targetPos - hrp.Position).Magnitude
		
		local bodyVel = Instance.new("BodyVelocity")
		bodyVel.MaxForce = Vector3.new(100000, 100000, 100000)
		bodyVel.Velocity = direction * math.min(distance * 3, 250)
		bodyVel.Parent = hrp
		
		if antiTPBack then humanoid.PlatformStand = true end
		task.wait(0.4)
		bodyVel:Destroy()
		if antiTPBack then humanoid.PlatformStand = false end
	end
end

-- Initialize
updateBadge()

print("==========================================")
print("Universal Teleport [FIXED VERSION]")
print("==========================================")
print("‚úÖ Draggable button (bottom right)")
print("‚úÖ Click button to open menu")
print("‚úÖ TP Tool - Equip and tap anywhere")
print("‚úÖ Quick TP - One-time tap teleport")
print("‚úÖ Save up to 20 locations")
print("‚úÖ Anti TP-back protection")
print("==========================================")
print("üí° Button is draggable!")
print("üí° Menu opens when you click it!")
print("==========================================")
